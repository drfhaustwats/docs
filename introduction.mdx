---
title: "Watts v3 controller"
description: "Dual-MCU ESP32 outdoor lighting system with synchronized LED control across Wi-Fi and BLE interfaces"
---

# Dual-MCU ESP32 Outdoor Lighting System

This documentation covers the Watts v3 controller firmware architecture, designed as a high-performance dual-MCU outdoor lighting system with synchronized LED control and robust communication protocols.

## System Architecture Overview

The Watts v2 controller implements a sophisticated dual-MCU topology that separates concerns while maintaining tight synchronization:

```
+-------------------------------------------------------------+
|                      ESP32-C5 (Main)                        |
|  • WLED Effects Engine (Arduino component)                  |
|  • Wi-Fi 2.4 / 5 GHz STA/AP                                 |
|  • ParlIO TX 1-bit @ 80 MHz + VALID pin → pixel stream      |
|  • RMT-TX Channel 0,1 → Local LED Strips                    |
|  • AT-Host task over UART0                                  |
+-----------------------▲-------------------------------------+
                        | 40 MHz ParlIO (DATA / CLK / VALID)
                        | Frame-select header + Ch-2/3 pixels
+-----------------------▼-------------------------------------+
|                      ESP32-H2 (Secondary)                   |
|  • AT-Firmware Core (NimBLE + Parser)                       |
|  • BLE 5.2 Peripheral                                       |
|  • ParlIO/SPI-Slave DMA RX                                  |
|  • RMT-TX Channel 2,3 → Remote LED Strips                   |
+-------------------------------------------------------------+
```

## MCU Role Separation

| Responsibility | ESP32-C5 (Main) | ESP32-H2 (Secondary) |
|---|---|---|
| **LED Channels** | Ch-0, Ch-1 (RMT-TX) | Ch-2, Ch-3 (RMT-TX) |
| **Effects Engine** | WLED renders full RGB frame | Mirrors pixel data |
| **Pixel Transport** | ParlIO TX, 80 MHz + VALID | ParlIO/SPI-Slave DMA RX |
| **Network Stack** | Wi-Fi 2.4/5 GHz, mDNS, HTTP(S) OTA | BLE (GAP + GATT) |
| **AT Protocol Role** | Master / Host | Slave / Device |

## Key Features

### Real-Time Synchronization
- **Sub-5µs latency** between MCU pixel output starts
- **Frame-locked rendering** with acknowledgment protocol
- **80 MHz ParlIO** high-speed inter-MCU communication

### Dual Network Interfaces
- **Wi-Fi Control**: Full WLED web interface, REST API, and UDP sync
- **BLE Control**: Low-power mobile control for basic operations
- **Seamless Handoff**: Configurations synchronized between interfaces

### Arduino Component Integration
Built on proven Arduino ecosystem components:
- **WLED Effects Engine**: Industry-standard lighting effects library
- **AsyncTCP & ESPAsyncWebServer**: Non-blocking network stack
- **Custom AT Command Framework**: Efficient inter-MCU communication
- **NimBLE Stack**: Lightweight Bluetooth implementation

## Communication Architecture

The system uses three primary communication channels:
1. **80 MHz ParlIO**: High-speed pixel data streaming
2. **5Mbauds UART**: AT command protocol and firmware updates
3. **Wi-Fi/BLE**: User control interfaces

## Getting Started

Explore the documentation sections for detailed implementation guides, hardware setup, and development workflows for both MCU platforms.